<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">

<!-- Remix Icons -->
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">

<!-- EmailJS -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<style>
    * { margin:0; padding:0; box-sizing:border-box; }
    
    body {
        font-family:'Tajawal',sans-serif;
        background: linear-gradient(135deg, #f5f7fb 0%, #e2e8f0 100%);
        display:flex;
        justify-content:center;
        align-items:center;
        min-height:100vh;
        padding:20px;
    }
    
    .container {
        width:100%;
        max-width:380px;
        background:#fff;
        padding:clamp(28px,6vw,40px);
        border-radius:24px;
        box-shadow:0 15px 40px rgba(0,0,0,0.12);
        text-align:center;
        position:relative;
        overflow:hidden;
    }
    
    .container::before {
        content:'';
        position:absolute;
        top:0;
        left:0;
        right:0;
        height:5px;
        background:linear-gradient(90deg, #f59e0b, #d97706);
    }
    
    h2 {
        font-size:clamp(22px,5vw,28px);
        margin-bottom:20px;
        color:#92400e;
        font-weight:700;
    }
    
    .message {
        display:none;
        margin-bottom:16px;
        padding:14px 18px;
        font-size:15px;
        border-radius:12px;
        font-weight:500;
        transition:all .3s ease;
    }
    
    .message.success {
        background:linear-gradient(135deg, #10b981, #059669);
        color:#fff;
        border-right:4px solid #34d399;
    }
    
    .message.error {
        background:linear-gradient(135deg, #ef4444, #dc2626);
        color:#fff;
        border-right:4px solid #f87171;
    }
    
    .message.loading {
        background:linear-gradient(135deg, #f59e0b, #d97706);
        color:#fff;
        border-right:4px solid #fbbf24;
    }
    
    .input-box {
        position:relative;
        margin-bottom:20px;
    }
    
    .input-box i {
        position:absolute;
        left:16px;
        top:50%;
        transform:translateY(-50%);
        font-size:20px;
        color:#9ca3af;
        z-index:2;
        transition:.2s;
    }
    
    .input-box input {
        width:100%;
        padding:16px 18px 16px 54px;
        border:2px solid #e5e7eb;
        border-radius:28px;
        font-size:16px;
        outline:none;
        font-family:'Tajawal',sans-serif;
        background:#fafbfc;
        transition:all .3s ease;
    }
    
    .input-box input:focus {
        border-color:#f59e0b;
        background:#fff;
        box-shadow:0 0 0 4px rgba(245,158,11,0.1);
    }
    
    .input-box input:focus + i {
        color:#f59e0b;
    }
    
    button {
        width:100%;
        padding:16px;
        border:none;
        border-radius:28px;
        font-size:17px;
        font-weight:600;
        cursor:pointer;
        font-family:'Tajawal',sans-serif;
        transition:all .3s ease;
        margin-bottom:16px;
        position:relative;
        overflow:hidden;
    }
    
    .send-btn {
        background:linear-gradient(135deg, #f59e0b, #d97706);
        color:#fff;
        box-shadow:0 6px 20px rgba(245,158,11,0.3);
    }
    
    .send-btn:hover:not(:disabled) {
        background:linear-gradient(135deg, #d97706, #b45309);
        transform:translateY(-2px);
        box-shadow:0 10px 30px rgba(245,158,11,0.4);
    }
    
    .send-btn:disabled {
        opacity:0.7;
        cursor:not-allowed;
        background:linear-gradient(135deg, #9ca3af, #6b7280);
    }
    
    .login-btn {
        background:#f8fafc;
        color:#475569;
        border:2px solid #e5e7eb;
    }
    
    .login-btn:hover {
        background:#f1f5f9;
        border-color:#d1d5db;
        transform:translateY(-1px);
    }
    
    .spinner {
        display:inline-block;
        width:18px;
        height:18px;
        border:2px solid rgba(255,255,255,0.3);
        border-radius:50%;
        border-top-color:#fff;
        animation:spin 1s ease-in-out infinite;
        margin-right:8px;
    }
    
    @keyframes spin {
        to { transform:rotate(360deg); }
    }
    
    @media (max-width:480px) {
        body { padding:12px; }
        .container { padding:24px 20px; }
        .input-box input { padding:14px 16px 14px 50px; font-size:15px; }
    }
</style>
</head>

<body>
<div class="container">
    <h2>Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>
    
    <div id="message" class="message"></div>
    
    <div class="input-box">
        <i class="ri-mail-line"></i>
        <input id="recoveryEmail" type="email" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ù…Ø³Ø¬Ù„" required>
    </div>
    
    <button class="send-btn" id="sendBtn" onclick="sendResetLink()">
        <span id="btnText">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©</span>
        <span id="spinner" class="spinner" style="display:none;"></span>
    </button>
    
    <button class="login-btn" onclick="window.location.href='login.html'">
        <i class="ri-arrow-left-line"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    </button>
</div>

<script>
    // ğŸ”¥ EmailJS Configuration
    emailjs.init("urmsYG_uydTuRjsXf"); // Public Key
    
    function showMessage(text, type = 'success') {
        const msg = document.getElementById('message');
        const btn = document.getElementById('sendBtn');
        
        msg.className = `message ${type}`;
        msg.textContent = text;
        msg.style.display = 'block';
        
        // Reset button
        btn.disabled = false;
        document.getElementById('btnText').style.display = 'inline';
        document.getElementById('spinner').style.display = 'none';
        
        if(type === 'success') {
            setTimeout(() => { msg.style.display = 'none'; }, 5000);
        }
    }
    
    function sendResetLink() {
        const email = document.getElementById('recoveryEmail').value.trim();
        const btn = document.getElementById('sendBtn');
        
        // Basic validation
        if(!email) {
            return showMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'error');
        }
        
        if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            return showMessage('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
        }
        
        // Loading state
        btn.disabled = true;
        document.getElementById('btnText').style.display = 'none';
        document.getElementById('spinner').style.display = 'inline';
        showMessage('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„...', 'loading');
        
        // Check if user exists in our system
        let users = [];
        try {
            const stored = localStorage.getItem('users');
            if(stored) users = JSON.parse(stored);
        } catch(e) {
            console.error('Users load error:', e);
        }
        
        const user = users.find(u => u.email && u.email.toLowerCase() === email.toLowerCase());
        
        if(!user) {
            setTimeout(() => {
                showMessage('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'error');
            }, 1000);
            return;
        }
        
        // Generate reset token (simple version)
        const resetToken = 'reset_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        const resetLink = `https://ofoq-xi.vercel.app/reset-password.html?token=${resetToken}&email=${encodeURIComponent(email)}`;
        const expiresIn = '1 Ø³Ø§Ø¹Ø©';
        
        // EmailJS template parameters
        const templateParams = {
            user_name: user.username,
            email: email,
            reset_link: resetLink,
            expires_in: expiresIn,
            company_name: 'Ù†Ø¸Ø§Ù…Ùƒ',
            support_email: 'majalatofoq@gmail.com'
        };
        
        // Send email via EmailJS
        emailjs.send('service_mpy2rwy', 'template_wgogk8m', templateParams)
            .then(function(response) {
                console.log('Email sent successfully!', response.status, response.text);
                showMessage('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ!', 'success');
                
                // Save token locally for demo (in real app, save to database)
                user.resetToken = resetToken;
                user.resetExpires = Date.now() + 60 * 60 * 1000; // 1 hour
                localStorage.setItem('users', JSON.stringify(users));
                
            }, function(error) {
                console.error('EmailJS error:', error);
                showMessage('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
            });
    }
    
    // Enter key support
    document.addEventListener('keypress', function(e) {
        if(e.key === 'Enter') {
            sendResetLink();
        }
    });
    
    // EmailJS ready check
    console.log('EmailJS Forgot Password Ready!');
</script>

</body>
</html>
